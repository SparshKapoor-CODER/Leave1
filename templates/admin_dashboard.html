{% extends "base.html" %}

{% block title %}Admin Dashboard - VIT LMS{% endblock %}

{% block extra_css %}
<style>
    .admin-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 15px;
        margin-bottom: 30px;
    }
    
    .stat-card {
        background: white;
        padding: 20px;
        border-radius: 10px;
        text-align: center;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        border-top: 5px solid;
        transition: transform 0.3s ease;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
    }
    
    .stat-card-1 { border-top-color: #007bff; }
    .stat-card-2 { border-top-color: #28a745; }
    .stat-card-3 { border-top-color: #ffc107; }
    .stat-card-4 { border-top-color: #dc3545; }
    .stat-card-5 { border-top-color: #6f42c1; }
    .stat-card-6 { border-top-color: #17a2b8; }
    
    .stat-number {
        font-size: 2.2rem;
        font-weight: bold;
        margin: 10px 0;
    }
    
    .suspicious-badge {
        position: absolute;
        top: -10px;
        right: -10px;
        background: #dc3545;
        color: white;
        border-radius: 50%;
        width: 25px;
        height: 25px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 12px;
        font-weight: bold;
    }
    
    .admin-nav {
        background: #343a40;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 25px;
    }
    

    .admin-nav .nav-link {
        color: #adb5bd;
        font-weight: 500;
        padding: 10px 15px;
        border-radius: 5px;
        transition: all 0.3s;
    }
    
    .admin-nav .nav-link:hover,
    .admin-nav .nav-link.active {
        color: white;
        background: rgba(255,255,255,0.1);
    }
    
    .log-item {
        border-left: 4px solid;
        padding-left: 15px;
        margin-bottom: 15px;
        padding: 10px 15px;
        background: #f8f9fa;
        border-radius: 5px;
    }
    
    .log-leave { border-left-color: #007bff; }
    .log-verification { border-left-color: #28a745; }
    .log-admin { border-left-color: #6c757d; }
    
    .quick-actions .btn {
        margin: 5px;
        min-width: 180px;
    }

    .notification {
    animation: slideIn 0.3s ease;
    margin-bottom: 10px;
}

.system-status {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    margin-left: 15px;
    padding: 5px 10px;
    background: rgba(255,255,255,0.1);
    border-radius: 4px;
}

.stat-number.updated {
    animation: pulse 1s;
}

@keyframes slideIn {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

.form-check-input:checked {
    background-color: #dc3545;
    border-color: #dc3545;
}

/* Report Generation Modal Styles */
#reportModal .modal-body {
    padding: 20px;
}

.report-option {
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 15px;
    margin-bottom: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.report-option:hover {
    background-color: #f8f9fa;
    border-color: #007bff;
    transform: translateY(-2px);
}

.report-option.selected {
    border-color: #28a745;
    background-color: #d4edda;
}

.report-icon {
    font-size: 2rem;
    margin-bottom: 10px;
    color: #dc3545;
}

.report-details {
    margin-top: 10px;
}
</style>
{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h3 mb-0" style="color: #dc3545;">
            <i class="fas fa-user-shield me-2"></i>Admin Dashboard
        </h1>
        <p class="text-muted mb-0">
            Welcome, {{ admin_name }} | Role: {{ admin_role|upper }}
        </p>
    </div>
    <div class="d-flex gap-2">
        <button class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#reportModal">
            <i class="fas fa-file-pdf me-2"></i>Generate Reports
        </button>
        <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#quickActionsModal">
            <i class="fas fa-bolt me-2"></i>Quick Actions
        </button>
        <a href="{{ url_for('admin_logout') }}" class="btn btn-outline-danger">
            <i class="fas fa-sign-out-alt me-2"></i>Logout
        </a>
    </div>
</div>

<!-- Admin Navigation -->
<div class="admin-nav">
    <div class="d-flex flex-wrap gap-2">
        <a href="{{ url_for('admin_dashboard') }}" class="nav-link active">
            <i class="fas fa-tachometer-alt me-2"></i>Dashboard
        </a>
        <a href="{{ url_for('admin_leaves') }}" class="nav-link">
            <i class="fas fa-calendar-alt me-2"></i>All Leaves
        </a>
        <a href="{{ url_for('admin_logs') }}" class="nav-link">
            <i class="fas fa-history me-2"></i>System Logs
        </a>
        <a href="{{ url_for('admin_users') }}" class="nav-link">
            <i class="fas fa-users me-2"></i>User Management
        </a>
        <a href="{{ url_for('admin_export_leaves') }}" class="nav-link">
            <i class="fas fa-file-export me-2"></i>Export Data
        </a>
        <a href="#settings" class="nav-link">
            <i class="fas fa-cog me-2"></i>Settings
        </a>
    </div>
</div>

<!-- System Statistics -->
<div class="admin-stats">
    <div class="stat-card stat-card-1">
        <i class="fas fa-user-graduate fa-2x text-primary"></i>
        <div class="stat-number">{{ stats.total_students }}</div>
        <p class="mb-0">Total Students</p>
    </div>
    <div class="stat-card stat-card-2">
        <i class="fas fa-chalkboard-teacher fa-2x text-success"></i>
        <div class="stat-number">{{ stats.total_proctors }}</div>
        <p class="mb-0">Proctors</p>
    </div>
    <div class="stat-card stat-card-3">
        <i class="fas fa-building fa-2x text-warning"></i>
        <div class="stat-number">{{ stats.total_supervisors }}</div>
        <p class="mb-0">Supervisors</p>
    </div>
    <div class="stat-card stat-card-4">
        <i class="fas fa-file-alt fa-2x text-danger"></i>
        <div class="stat-number">{{ stats.total_leaves }}</div>
        <p class="mb-0">Total Leaves</p>
    </div>
    <div class="stat-card stat-card-5">
        <i class="fas fa-clock fa-2x text-info"></i>
        <div class="stat-number">{{ stats.pending_leaves }}</div>
        <p class="mb-0">Pending</p>
    </div>
    <div class="stat-card stat-card-6">
        <i class="fas fa-exclamation-triangle fa-2x text-danger"></i>
        <div class="stat-number">{{ stats.suspicious_leaves }}</div>
        <p class="mb-0">Suspicious</p>
    </div>
</div>

<!-- Quick Stats Row -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card bg-primary text-white">
            <div class="card-body text-center">
                <h6 class="mb-2">Today's Leaves</h6>
                <h2 class="mb-0">{{ stats.today_leaves }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-success text-white">
            <div class="card-body text-center">
                <h6 class="mb-2">Approved</h6>
                <h2 class="mb-0">{{ stats.approved_leaves }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-warning text-white">
            <div class="card-body text-center">
                <h6 class="mb-2">Pending</h6>
                <h2 class="mb-0">{{ stats.pending_leaves }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card bg-danger text-white">
            <div class="card-body text-center">
                <h6 class="mb-2">Suspicious</h6>
                <h2 class="mb-0">{{ stats.suspicious_leaves }}</h2>
            </div>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="row">
    <!-- Recent Activity -->
    <div class="col-md-7">
        <div class="card card-vit mb-4">
            <div class="card-header-vit">
                <h5 class="card-title mb-0">
                    <i class="fas fa-history me-2"></i>Recent System Activity
                </h5>
            </div>
            <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                {% if recent_logs %}
                    {% for log in recent_logs %}
                    <div class="log-item log-{{ log.log_type }}">
                        <div class="d-flex justify-content-between">
                            <div>
                                <strong>{{ log.action }}</strong>
                                <small class="text-muted d-block">
                                    {% if log.log_type == 'leave' %}
                                        <i class="fas fa-calendar me-1"></i>
                                    {% elif log.log_type == 'verification' %}
                                        <i class="fas fa-qrcode me-1"></i>
                                    {% else %}
                                        <i class="fas fa-user-shield me-1"></i>
                                    {% endif %}
                                    {{ log.log_type|title }} - {{ log.user_id }}
                                </small>
                            </div>
                            <div class="text-end">
                                <small class="text-muted">{{ log.timestamp.strftime('%H:%M') }}</small><br>
                                <small>{{ log.timestamp.strftime('%b %d') }}</small>
                            </div>
                        </div>
                        {% if log.details %}
                            <small class="text-muted">{{ log.details[:100] }}{% if log.details|length > 100 %}...{% endif %}</small>
                        {% endif %}
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                        <p class="text-muted">No recent activity</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
    
    <!-- Suspicious Leaves -->
    <div class="col-md-5">
        <div class="card card-vit mb-4">
            <div class="card-header-vit" style="background: linear-gradient(90deg, #dc3545 0%, #fd7e14 100%);">
                <h5 class="card-title mb-0 text-white">
                    <i class="fas fa-exclamation-triangle me-2"></i>Suspicious Leaves
                </h5>
            </div>
            <div class="card-body" style="max-height: 400px; overflow-y: auto;">
                {% if suspicious_leaves %}
                    {% for leave in suspicious_leaves %}
                    <div class="alert alert-warning mb-3">
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 class="alert-heading mb-1">
                                    {{ leave.student_name }} ({{ leave.reg_number }})
                                </h6>
                                <p class="mb-1 small">
                                    <i class="fas fa-calendar me-1"></i>
                                    {{ leave.from_date }} to {{ leave.to_date }}
                                </p>
                                <p class="mb-2 small">
                                    <i class="fas fa-map-marker-alt me-1"></i>
                                    {{ leave.destination }}
                                </p>
                                {% if leave.flag_reason %}
                                    <p class="mb-1 small">
                                        <strong>Flag Reason:</strong> {{ leave.flag_reason }}
                                    </p>
                                {% endif %}
                            </div>
                            <div class="text-end">
                                <small class="text-muted">{{ leave.applied_at.strftime('%b %d') }}</small><br>
                                <a href="{{ url_for('admin_leaves') }}?status={{ leave.status }}" 
                                   class="btn btn-sm btn-outline-danger mt-1">
                                    <i class="fas fa-eye"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center py-4">
                        <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                        <p class="text-muted">No suspicious leaves detected</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Report Generation Modal -->
<div class="modal fade" id="reportModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="background: #28a745; color: white;">
                <h5 class="modal-title">
                    <i class="fas fa-file-pdf me-2"></i>Generate Reports
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="report-option" onclick="selectReport('monthly_summary')" id="report-monthly">
                            <div class="text-center">
                                <i class="fas fa-chart-line report-icon"></i>
                                <h6>Monthly Summary</h6>
                                <small class="text-muted">Monthly leave statistics and trends</small>
                            </div>
                            <div class="report-details">
                                <ul class="small">
                                    <li>Leave trends by month</li>
                                    <li>Approval rates</li>
                                    <li>Most common leave types</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="report-option" onclick="selectReport('leave_statistics')" id="report-statistics">
                            <div class="text-center">
                                <i class="fas fa-chart-bar report-icon"></i>
                                <h6>Leave Statistics</h6>
                                <small class="text-muted">Detailed leave data with filters</small>
                            </div>
                            <div class="report-details">
                                <ul class="small">
                                    <li>Filter by date range</li>
                                    <li>Status breakdown</li>
                                    <li>Detailed leave records</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-6">
                        <div class="report-option" onclick="selectReport('user_activity')" id="report-activity">
                            <div class="text-center">
                                <i class="fas fa-users report-icon"></i>
                                <h6>User Activity</h6>
                                <small class="text-muted">User engagement and activity report</small>
                            </div>
                            <div class="report-details">
                                <ul class="small">
                                    <li>User login activity</li>
                                    <li>Action frequency</li>
                                    <li>System usage patterns</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="report-option" onclick="selectReport('suspicious_activity')" id="report-suspicious">
                            <div class="text-center">
                                <i class="fas fa-exclamation-triangle report-icon"></i>
                                <h6>Suspicious Activity</h6>
                                <small class="text-muted">Flagged and suspicious leave patterns</small>
                            </div>
                            <div class="report-details">
                                <ul class="small">
                                    <li>All flagged leaves</li>
                                    <li>Pattern analysis</li>
                                    <li>Risk assessment</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mt-4" id="reportFilters" style="display: none;">
                    <h6>Report Filters</h6>
                    <div class="row">
                        <div class="col-md-6">
                            <label for="dateFrom" class="form-label">From Date</label>
                            <input type="date" class="form-control" id="dateFrom">
                        </div>
                        <div class="col-md-6">
                            <label for="dateTo" class="form-label">To Date</label>
                            <input type="date" class="form-control" id="dateTo">
                        </div>
                    </div>
                    <div class="mt-3" id="additionalFilters">
                        <!-- Additional filters will be added here based on report type -->
                    </div>
                </div>
                
                <div class="mt-4 d-flex justify-content-between">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-2"></i>Cancel
                    </button>
                    <button type="button" class="btn btn-success" onclick="generateSelectedReport()" id="generateReportBtn" disabled>
                        <i class="fas fa-file-download me-2"></i>Generate Report
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Quick Actions Modal -->
<div class="modal fade" id="quickActionsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header" style="background: #dc3545; color: white;">
                <h5 class="modal-title">
                    <i class="fas fa-bolt me-2"></i>Quick Actions
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row text-center quick-actions">
                    <div class="col-md-4 mb-3">
                        <a href="{{ url_for('admin_users') }}" class="btn btn-primary w-100">
                            <i class="fas fa-user-plus me-2"></i>Add New User
                        </a>
                    </div>
                    <div class="col-md-4 mb-3">
                        <button class="btn btn-success w-100" onclick="exportLeavesData()">
                            <i class="fas fa-file-export me-2"></i>Export Leaves
                        </button>
                    </div>
                    <div class="col-md-4 mb-3">
                        <a href="{{ url_for('admin_logs') }}" class="btn btn-info w-100">
                            <i class="fas fa-history me-2"></i>View Logs
                        </a>
                    </div>
                    <div class="col-md-4 mb-3">
                        <button class="btn btn-warning w-100" data-bs-toggle="modal" data-bs-target="#reportModal">
                            <i class="fas fa-file-pdf me-2"></i>Reports
                        </button>
                    </div>
                    <div class="col-md-4 mb-3">
                        <button class="btn btn-dark w-100" onclick="clearOldLogs()">
                            <i class="fas fa-trash-alt me-2"></i>Clear Old Logs
                        </button>
                    </div>
                    <div class="col-md-4 mb-3">
                        <a href="{{ url_for('admin_export_leaves') }}" class="btn btn-secondary w-100">
                            <i class="fas fa-download me-2"></i>Export CSV
                        </a>
                    </div>
                </div>
                
                <hr>
                
                <h6 class="mb-3">Quick Links:</h6>
                <div class="row">
                    <div class="col-md-6">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">
                                <a href="{{ url_for('admin_leaves') }}?status=pending">
                                    <i class="fas fa-clock text-warning me-2"></i>Pending Leaves
                                </a>
                            </li>
                            <li class="list-group-item">
                                <a href="{{ url_for('admin_leaves') }}?suspicious_only=true">
                                    <i class="fas fa-exclamation-triangle text-danger me-2"></i>All Suspicious
                                </a>
                            </li>
                            <li class="list-group-item">
                                <a href="{{ url_for('admin_logs') }}">
                                    <i class="fas fa-history text-info me-2"></i>Recent Logs
                                </a>
                            </li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <ul class="list-group list-group-flush">
                            <li class="list-group-item">
                                <a href="{{ url_for('admin_users') }}">
                                    <i class="fas fa-users text-success me-2"></i>All Users
                                </a>
                            </li>
                            <li class="list-group-item">
                                <a href="{{ url_for('admin_export_leaves') }}">
                                    <i class="fas fa-file-csv text-secondary me-2"></i>Export Data
                                </a>
                            </li>
                            <li class="list-group-item">
                                <a href="#">
                                    <i class="fas fa-shield-alt text-primary me-2"></i>Security
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let selectedReportType = null;
    let selectedReportName = null;

    document.addEventListener('DOMContentLoaded', function() {
        setupReportModal();
        setupEventListeners();
    });

    function setupReportModal() {
        // Initialize date fields to current month
        const today = new Date();
        const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
        const lastDay = new Date(today.getFullYear(), today.getMonth() + 1, 0);
        
        document.getElementById('dateFrom').value = formatDate(firstDay);
        document.getElementById('dateTo').value = formatDate(lastDay);
        
        // Add event listeners to report options
        document.querySelectorAll('.report-option').forEach(option => {
            option.addEventListener('click', function() {
                document.querySelectorAll('.report-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                this.classList.add('selected');
            });
        });
    }

    function formatDate(date) {
        const year = date.getFullYear();
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const day = String(date.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    function selectReport(reportType) {
        selectedReportType = reportType;
        
        // Update button text and enable it
        const generateBtn = document.getElementById('generateReportBtn');
        const reportNames = {
            'monthly_summary': 'Monthly Summary',
            'leave_statistics': 'Leave Statistics',
            'user_activity': 'User Activity',
            'suspicious_activity': 'Suspicious Activity'
        };
        selectedReportName = reportNames[reportType];
        
        generateBtn.innerHTML = `<i class="fas fa-file-download me-2"></i>Generate ${selectedReportName}`;
        generateBtn.disabled = false;
        
        // Show filters for certain report types
        const filtersDiv = document.getElementById('reportFilters');
        const additionalFilters = document.getElementById('additionalFilters');
        
        if (reportType === 'leave_statistics' || reportType === 'suspicious_activity') {
            filtersDiv.style.display = 'block';
            
            if (reportType === 'leave_statistics') {
                additionalFilters.innerHTML = `
                    <div class="row">
                        <div class="col-md-6">
                            <label for="statusFilter" class="form-label">Status</label>
                            <select class="form-select" id="statusFilter">
                                <option value="">All Status</option>
                                <option value="pending">Pending</option>
                                <option value="approved">Approved</option>
                                <option value="rejected">Rejected</option>
                                <option value="completed">Completed</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="typeFilter" class="form-label">Leave Type</label>
                            <select class="form-select" id="typeFilter">
                                <option value="">All Types</option>
                                <option value="emergency">Emergency</option>
                                <option value="regular">Regular</option>
                                <option value="medical">Medical</option>
                            </select>
                        </div>
                    </div>
                `;
            } else {
                additionalFilters.innerHTML = '';
            }
        } else {
            filtersDiv.style.display = 'none';
        }
    }

    function generateSelectedReport() {
        if (!selectedReportType) {
            showNotification('Please select a report type first!', 'error');
            return;
        }
        
        showLoading(`Generating ${selectedReportName} report...`);
        
        let url = `/admin/generate-pdf/${selectedReportType}`;
        let params = [];
        
        // Add date filters if available
        const dateFrom = document.getElementById('dateFrom')?.value;
        const dateTo = document.getElementById('dateTo')?.value;
        
        if (dateFrom && dateTo) {
            params.push(`date_from=${dateFrom}`);
            params.push(`date_to=${dateTo}`);
        }
        
        // Add additional filters for leave statistics
        if (selectedReportType === 'leave_statistics') {
            const status = document.getElementById('statusFilter')?.value;
            const leaveType = document.getElementById('typeFilter')?.value;
            
            if (status) params.push(`status=${status}`);
            if (leaveType) params.push(`leave_type=${leaveType}`);
        }
        
        // Add suspicious flag if needed
        if (selectedReportType === 'suspicious_activity') {
            params.push('suspicious_only=true');
        }
        
        if (params.length > 0) {
            url += '?' + params.join('&');
        }
        
        // Create a hidden iframe to download the PDF
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = url;
        document.body.appendChild(iframe);
        
        // Wait a bit and then hide loading
        setTimeout(() => {
            hideLoading();
            
            // Check if download started
            setTimeout(() => {
                iframe.remove();
                showNotification(`${selectedReportName} report generated successfully!`, 'success');
                
                // Close the modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('reportModal'));
                if (modal) modal.hide();
                
            }, 2000);
            
        }, 3000);
    }

    function exportLeavesData() {
        showLoading('Exporting leaves data as CSV...');
        
        // Create a hidden iframe to download the CSV
        const iframe = document.createElement('iframe');
        iframe.style.display = 'none';
        iframe.src = '/admin/export/leaves';
        document.body.appendChild(iframe);
        
        setTimeout(() => {
            hideLoading();
            iframe.remove();
            showNotification('Leaves data exported successfully as CSV!', 'success');
        }, 2000);
    }

    function clearOldLogs() {
        if (confirm('Are you sure you want to clear logs older than 30 days? This action cannot be undone.')) {
            showLoading('Clearing old logs...');
            
            fetch('/admin/clear-old-logs')
                .then(response => {
                    hideLoading();
                    if (response.ok) {
                        return response.text();
                    }
                    throw new Error('Network response was not ok');
                })
                .then(data => {
                    showNotification('Old logs cleared successfully!', 'success');
                    // Refresh the page after a delay
                    setTimeout(() => {
                        window.location.reload();
                    }, 1500);
                })
                .catch(error => {
                    hideLoading();
                    showNotification('Error clearing logs: ' + error.message, 'error');
                });
        }
    }

    function setupEventListeners() {
        // Add click handlers for quick action buttons
        document.querySelectorAll('.quick-actions .btn').forEach(btn => {
            btn.addEventListener('click', function() {
                console.log(`Quick action: ${this.innerText.trim()}`);
            });
        });
    }

    function showNotification(message, type = 'info', duration = 5000) {
        // Create notification element
        const notification = document.createElement('div');
        notification.className = `notification alert alert-${type} alert-dismissible fade show`;
        notification.innerHTML = `
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            ${message}
        `;
        
        // Add to notification container
        const container = document.getElementById('notification-container') || createNotificationContainer();
        container.appendChild(notification);
        
        // Auto-remove after duration
        if (duration > 0) {
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, duration);
        }
        
        return notification;
    }

    function createNotificationContainer() {
        const container = document.createElement('div');
        container.id = 'notification-container';
        container.style.cssText = `
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 9999;
            max-width: 350px;
        `;
        document.body.appendChild(container);
        return container;
    }

    function showLoading(message = 'Processing...') {
        // Create or show loading overlay
        let overlay = document.getElementById('loading-overlay');
        if (!overlay) {
            overlay = document.createElement('div');
            overlay.id = 'loading-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.7);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 99999;
                color: white;
                flex-direction: column;
            `;
            overlay.innerHTML = `
                <div class="spinner-border mb-3" role="status"></div>
                <div class="loading-message">${message}</div>
            `;
            document.body.appendChild(overlay);
        } else {
            overlay.style.display = 'flex';
            overlay.querySelector('.loading-message').textContent = message;
        }
    }

    function hideLoading() {
        const overlay = document.getElementById('loading-overlay');
        if (overlay) {
            overlay.style.display = 'none';
        }
    }
</script>
{% endblock %}